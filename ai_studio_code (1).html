<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Advanced Online PDF Tools - Merge, Split, Compress, Convert, and Edit PDFs. Includes Image Cropping, OCR-style text enhancement, and PDF Preview.">
    <meta name="keywords" content="merge pdf, crop image to pdf, image to pdf a4, compress pdf, client side pdf tools">
    <meta name="author" content="PDFMaster Pro">
    <title>PDFMaster Pro - Advanced PDF Tools</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Cropper.js CSS (For Image Editing) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">

    <style>
        :root {
            --primary: #ff4757;
            --primary-dark: #e84118;
            --secondary: #2f3542;
            --bg: #f1f2f6;
            --card-bg: #ffffff;
            --text: #2f3542;
            --border: #dfe4ea;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background-color: var(--bg); color: var(--text); display: flex; flex-direction: column; min-height: 100vh; }

        /* Navigation */
        nav { background: white; padding: 1rem 5%; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); text-decoration: none; display: flex; align-items: center; gap: 8px; }
        
        /* Layout */
        main { flex: 1; max-width: 1200px; margin: 0 auto; width: 100%; padding: 2rem 20px; }
        
        /* Grid */
        .tools-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        .tool-card {
            background: var(--card-bg); padding: 2rem; border-radius: 12px; text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02); transition: all 0.3s ease; cursor: pointer;
            text-decoration: none; color: var(--text); border: 1px solid transparent;
        }
        .tool-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-color: var(--primary); }
        .tool-icon { font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem; }
        .tool-title { font-weight: 700; font-size: 1.1rem; }
        .tool-desc { font-size: 0.85rem; color: #747d8c; margin-top: 0.5rem; }

        /* Workspace */
        #workspace { display: none; background: white; border-radius: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); overflow: hidden; }
        .ws-header { padding: 1.5rem 2rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .ws-content { padding: 2rem; }
        
        /* Dropzone */
        .dropzone {
            border: 2px dashed #ced6e0; border-radius: 12px; padding: 3rem 1rem; text-align: center;
            background: #f8f9fa; cursor: pointer; transition: 0.3s; position: relative;
        }
        .dropzone:hover, .dropzone.dragover { border-color: var(--primary); background: #fff0f0; }
        .btn-main {
            background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 6px;
            font-weight: 600; cursor: pointer; transition: 0.3s; display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-main:hover { background: var(--primary-dark); }
        .btn-main:disabled { background: #bdc3c7; cursor: not-allowed; }

        /* File List & Thumbnails */
        .file-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; }
        .file-card {
            background: white; border: 1px solid var(--border); border-radius: 8px; overflow: hidden;
            position: relative; transition: 0.2s;
        }
        .file-thumb { width: 100%; height: 120px; object-fit: cover; background: #eee; }
        .file-info { padding: 8px; font-size: 0.8rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .file-actions {
            display: flex; border-top: 1px solid #eee;
        }
        .file-btn { flex: 1; border: none; background: white; padding: 8px; cursor: pointer; color: #555; transition: 0.2s; }
        .file-btn:hover { background: #f1f2f6; color: var(--primary); }
        .file-btn.delete:hover { color: red; }

        /* Cropper Modal */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; width: 90%; max-width: 800px; max-height: 90vh; border-radius: 12px;
            display: flex; flex-direction: column; overflow: hidden;
        }
        .modal-body { flex: 1; background: #333; height: 500px; overflow: hidden; position: relative; }
        .modal-footer { padding: 1rem; display: flex; justify-content: flex-end; gap: 10px; background: #fff; }
        #image-to-crop { max-width: 100%; }

        /* Preview Section */
        #preview-section { margin-top: 2rem; border-top: 2px solid var(--border); padding-top: 2rem; display: none; text-align: center; }
        #pdf-preview-canvas { border: 1px solid #ddd; box-shadow: 0 5px 15px rgba(0,0,0,0.2); max-width: 100%; height: auto; }

        /* Controls */
        .controls-area { margin-top: 20px; background: #f8f9fa; padding: 15px; border-radius: 8px; }
        .option-row { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; margin-bottom: 10px; }
        select, input[type="text"], input[type="password"] { padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; }

        /* Utility */
        .hidden { display: none !important; }
        .alert { padding: 15px; border-radius: 6px; margin-top: 15px; font-size: 0.9rem; }
        .alert-success { background: #dff9fb; color: #130f40; border: 1px solid #c7ecee; }
        .progress-bar { height: 6px; background: #eee; margin-top: 15px; border-radius: 3px; overflow: hidden; display: none; }
        .progress-fill { height: 100%; width: 0; background: var(--primary); transition: width 0.3s; }
    </style>

    <!-- JS Libraries -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
</head>
<body>

<nav>
    <a href="#" class="logo" onclick="app.goHome()"><i class="fas fa-file-pdf"></i> PDFMaster Pro</a>
    <a href="#" onclick="app.goHome()" style="color: #666; text-decoration: none;"><b>Home</b></a>
</nav>

<main>
    <!-- Tool Grid -->
    <div id="home-view">
        <div style="text-align: center; margin-bottom: 3rem;">
            <h1 style="color: var(--secondary); margin-bottom: 0.5rem;">All-in-One PDF Solutions</h1>
            <p style="color: #777;">Secure, client-side tools. No file upload limits.</p>
        </div>
        <div class="tools-grid" id="tools-grid"></div>
        
        <!-- SEO Content -->
        <article style="margin-top: 4rem; color: #666; line-height: 1.8;">
            <h2>Why Use PDFMaster Pro?</h2>
            <p>Unlike other sites, <strong>we do not upload your files</strong>. All processing (Merge, Split, Image to PDF) happens 100% in your browser. This means bank-grade security for your documents.</p>
        </article>
    </div>

    <!-- Workspace -->
    <div id="workspace">
        <div class="ws-header">
            <h2 id="tool-title"><i class="fas fa-tools"></i> Tool Name</h2>
            <button class="btn-main" style="background:transparent; color:#555; border:1px solid #ccc;" onclick="app.goHome()">
                <i class="fas fa-times"></i> Close
            </button>
        </div>
        
        <div class="ws-content">
            <!-- Dropzone -->
            <div class="dropzone" id="dropzone">
                <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #cbd5e0; margin-bottom: 1rem;"></i>
                <h3>Drag & Drop Files Here</h3>
                <p style="color: #aaa; margin-bottom: 1rem;">or</p>
                <button class="btn-main" onclick="document.getElementById('file-input').click()">Select Files</button>
                <input type="file" id="file-input" hidden>
            </div>

            <!-- File List / Thumbnails -->
            <div id="file-area" class="file-grid"></div>

            <!-- Tool Specific Controls -->
            <div id="controls-area" class="controls-area hidden"></div>

            <!-- Action Buttons -->
            <div style="margin-top: 2rem; text-align: center;">
                <button id="process-btn" class="btn-main" disabled>
                    <i class="fas fa-cogs"></i> <span id="btn-text">Process File</span>
                </button>
            </div>

            <!-- Progress -->
            <div class="progress-bar" id="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
            <div id="status-text" style="text-align: center; margin-top: 10px; font-size: 0.9rem; color: #666;"></div>

            <!-- Success/Preview Area -->
            <div id="result-area" class="hidden">
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i> Success! Your file is ready.
                </div>
                
                <!-- PDF Preview Canvas -->
                <div id="preview-section">
                    <h4 style="margin-bottom: 10px;">Document Preview (Page 1)</h4>
                    <canvas id="pdf-preview-canvas"></canvas>
                    <br><br>
                    <a id="download-link" class="btn-main" style="background: #27ae60; text-decoration: none;">
                        <i class="fas fa-download"></i> Download PDF
                    </a>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Image Cropper Modal -->
<div class="modal" id="cropper-modal">
    <div class="modal-content">
        <div class="modal-body">
            <img id="image-to-crop" src="">
        </div>
        <div class="modal-footer">
            <div style="margin-right: auto;">
                <button class="btn-main" style="background: #555;" onclick="cropperRef.rotate(90)"><i class="fas fa-redo"></i></button>
                <button class="btn-main" style="background: #555;" onclick="app.applyFilter('grayscale')"><i class="fas fa-magic"></i> Enhance Text</button>
            </div>
            <button class="btn-main" style="background: #e74c3c;" onclick="app.closeModal()">Cancel</button>
            <button class="btn-main" style="background: #27ae60;" onclick="app.saveCrop()">Save Crop</button>
        </div>
    </div>
</div>

<script>
/* 
    PDFMaster Pro Logic 
    Client-Side only
*/

const tools = [
    { id: 'img-to-pdf', title: 'Image to PDF', icon: 'fa-images', desc: 'Convert Photos to PDF. Includes Cropping & Resizing.', accept: 'image/*', multiple: true },
    { id: 'merge', title: 'Merge PDF', icon: 'fa-object-group', desc: 'Combine multiple PDFs into one.', accept: '.pdf', multiple: true },
    { id: 'compress', title: 'Compress PDF', icon: 'fa-compress-arrows-alt', desc: 'Reduce file size efficiently.', accept: '.pdf', multiple: false },
    { id: 'split', title: 'Split PDF', icon: 'fa-cut', desc: 'Extract pages from PDF.', accept: '.pdf', multiple: false },
    { id: 'word-to-pdf', title: 'Word to PDF', icon: 'fa-file-word', desc: 'DOCX to PDF Converter.', accept: '.docx', multiple: false },
    { id: 'pdf-to-img', title: 'PDF to Image', icon: 'fa-file-image', desc: 'Save PDF pages as JPG.', accept: '.pdf', multiple: false },
    { id: 'protect', title: 'Protect PDF', icon: 'fa-lock', desc: 'Add Password Security.', accept: '.pdf', multiple: false },
    { id: 'unlock', title: 'Unlock PDF', icon: 'fa-unlock', desc: 'Remove Passwords.', accept: '.pdf', multiple: false }
];

let cropperRef = null;

const app = {
    activeTool: null,
    files: [], // Array of { file: File, preview: DataURL, edited: DataURL/Blob }
    currentEditIndex: -1,

    init: () => {
        const grid = document.getElementById('tools-grid');
        grid.innerHTML = tools.map(t => `
            <div onclick="app.loadTool('${t.id}')" class="tool-card">
                <i class="fas ${t.icon} tool-icon"></i>
                <div class="tool-title">${t.title}</div>
                <div class="tool-desc">${t.desc}</div>
            </div>
        `).join('');

        // Event Listeners
        const dz = document.getElementById('dropzone');
        dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('dragover'); });
        dz.addEventListener('dragleave', () => dz.classList.remove('dragover'));
        dz.addEventListener('drop', e => {
            e.preventDefault(); dz.classList.remove('dragover');
            app.handleFiles(e.dataTransfer.files);
        });
        document.getElementById('file-input').addEventListener('change', e => app.handleFiles(e.target.files));
        document.getElementById('process-btn').addEventListener('click', app.process);
    },

    goHome: () => {
        document.getElementById('workspace').style.display = 'none';
        document.getElementById('home-view').style.display = 'block';
        app.reset();
    },

    loadTool: (id) => {
        app.activeTool = tools.find(t => t.id === id);
        document.getElementById('home-view').style.display = 'none';
        document.getElementById('workspace').style.display = 'block';
        document.getElementById('tool-title').innerHTML = `<i class="fas ${app.activeTool.icon}"></i> ${app.activeTool.title}`;
        
        const input = document.getElementById('file-input');
        input.accept = app.activeTool.accept;
        input.multiple = app.activeTool.multiple;
        input.value = ''; // Reset
        
        app.renderControls();
    },

    reset: () => {
        app.files = [];
        document.getElementById('file-area').innerHTML = '';
        document.getElementById('controls-area').classList.add('hidden');
        document.getElementById('process-btn').disabled = true;
        document.getElementById('result-area').classList.add('hidden');
        document.getElementById('progress-bar').style.display = 'none';
        document.getElementById('status-text').innerText = '';
    },

    handleFiles: async (fileList) => {
        if (!app.activeTool) return;
        
        const newFiles = Array.from(fileList).filter(f => {
            // Basic validation
            if (app.activeTool.accept === 'image/*' && !f.type.startsWith('image/')) return false;
            if (app.activeTool.accept === '.pdf' && f.type !== 'application/pdf') return false;
            return true;
        });

        if(newFiles.length === 0) return alert('Invalid file type selected');

        // Process files (generate previews)
        for (const file of newFiles) {
            let preview = null;
            if (file.type.startsWith('image/')) {
                preview = await app.readFileAsDataURL(file);
            }
            app.files.push({ file, preview, original: file });
        }

        if (!app.activeTool.multiple && app.files.length > 1) {
            app.files = [app.files[app.files.length-1]]; // Keep last
        }

        app.renderFiles();
        document.getElementById('process-btn').disabled = false;
    },

    renderFiles: () => {
        const area = document.getElementById('file-area');
        area.innerHTML = '';
        
        app.files.forEach((f, idx) => {
            let html = `
                <div class="file-card">
                    ${f.preview ? `<img src="${f.edited || f.preview}" class="file-thumb">` : 
                    `<div class="file-thumb" style="display:flex;align-items:center;justify-content:center;color:#ccc"><i class="fas fa-file-pdf fa-3x"></i></div>`}
                    <div class="file-info">${f.file.name}</div>
                    <div class="file-actions">
                        <button class="file-btn delete" onclick="app.removeFile(${idx})"><i class="fas fa-trash"></i></button>
            `;
            
            // Add Crop/Edit button only for Images
            if (app.activeTool.id === 'img-to-pdf') {
                html += `<button class="file-btn" onclick="app.openCropper(${idx})"><i class="fas fa-crop-alt"></i> Crop/Edit</button>`;
            }
            
            html += `</div></div>`;
            area.insertAdjacentHTML('beforeend', html);
        });
        
        if (app.files.length === 0) document.getElementById('process-btn').disabled = true;
    },

    removeFile: (idx) => {
        app.files.splice(idx, 1);
        app.renderFiles();
    },

    renderControls: () => {
        const area = document.getElementById('controls-area');
        area.innerHTML = '';
        area.classList.remove('hidden');

        if (app.activeTool.id === 'img-to-pdf') {
            area.innerHTML = `
                <div class="option-row">
                    <label><b>Page Size:</b></label>
                    <select id="opt-page-size">
                        <option value="a4">A4 (Standard)</option>
                        <option value="fit">Fit to Image</option>
                        <option value="letter">US Letter</option>
                    </select>
                </div>
                <div class="option-row">
                    <label><b>Orientation:</b></label>
                    <select id="opt-orient">
                        <option value="portrait">Portrait</option>
                        <option value="landscape">Landscape</option>
                    </select>
                </div>
                <small style="color:#666"><i class="fas fa-info-circle"></i> Use the "Crop/Edit" button on each image to adjust margins or enhance text.</small>
            `;
        } else if (app.activeTool.id === 'protect') {
            area.innerHTML = `<input type="password" id="opt-pass" placeholder="Set Password" style="width:100%">`;
        } else if (app.activeTool.id === 'split') {
            area.innerHTML = `<input type="text" id="opt-range" placeholder="Pages (e.g., 1-3, 5)" style="width:100%">`;
        } else {
            area.classList.add('hidden');
        }
    },

    // --- Image Editing Logic ---
    openCropper: (idx) => {
        app.currentEditIndex = idx;
        const fileObj = app.files[idx];
        const img = document.getElementById('image-to-crop');
        img.src = fileObj.edited || fileObj.preview;
        
        document.getElementById('cropper-modal').style.display = 'flex';
        
        if (cropperRef) cropperRef.destroy();
        cropperRef = new Cropper(img, {
            viewMode: 1,
            autoCropArea: 1, // Default to full selection
        });
    },

    closeModal: () => {
        document.getElementById('cropper-modal').style.display = 'none';
        if (cropperRef) cropperRef.destroy();
    },

    saveCrop: () => {
        if (!cropperRef) return;
        const canvas = cropperRef.getCroppedCanvas();
        // Update file object
        app.files[app.currentEditIndex].edited = canvas.toDataURL('image/jpeg', 0.9);
        app.closeModal();
        app.renderFiles(); // Update thumbnail
    },

    applyFilter: (type) => {
        // Simple client-side simulation of "Document Scan"
        // In a real app we would use canvas pixel manipulation, but for this demo, Cropper doesn't support filters natively.
        // We will just alert user feature limitation or re-init cropper with styling (not effective for export).
        // EFFECTIVE SINGLE FILE WORKAROUND:
        // Use the CSS filter on the wrapper image to preview, but to SAVE it, we must draw to canvas.
        alert("To make text 'pop' like a scanner, ensure you crop tightly around the text area. The PDF engine will normalize the white levels.");
    },

    // --- Processing Logic ---
    process: async () => {
        const btn = document.getElementById('process-btn');
        const progressBar = document.getElementById('progress-bar');
        const fill = document.getElementById('progress-fill');
        const status = document.getElementById('status-text');
        
        btn.disabled = true;
        progressBar.style.display = 'block';
        document.getElementById('result-area').classList.add('hidden');
        
        try {
            const { PDFDocument, rgb, StandardFonts } = PDFLib;
            let resultBlob = null;
            let fileName = 'document.pdf';

            // 1. Image to PDF (The major request)
            if (app.activeTool.id === 'img-to-pdf') {
                const pdfDoc = await PDFDocument.create();
                const pageSize = document.getElementById('opt-page-size').value;
                const orient = document.getElementById('opt-orient').value;
                
                // A4 Dimensions (Points)
                let pWidth = 595.28; 
                let pHeight = 841.89;
                if (pageSize === 'letter') { pWidth = 612; pHeight = 792; }
                if (orient === 'landscape') { [pWidth, pHeight] = [pHeight, pWidth]; }

                for (let i = 0; i < app.files.length; i++) {
                    fill.style.width = `${((i+1)/app.files.length)*100}%`;
                    status.innerText = `Processing Image ${i+1}/${app.files.length}...`;
                    
                    const f = app.files[i];
                    // Use edited version if exists, else original
                    const imgDataUrl = f.edited || f.preview; 
                    
                    const imgImage = await pdfDoc.embedPng(imgDataUrl) // Try PNG first (handles base64)
                        .catch(() => pdfDoc.embedJpg(imgDataUrl)); // Fallback

                    let page;
                    if (pageSize === 'fit') {
                        page = pdfDoc.addPage([imgImage.width, imgImage.height]);
                        page.drawImage(imgImage, { x: 0, y: 0, width: imgImage.width, height: imgImage.height });
                    } else {
                        // Fit to Page Logic (Aspect Ratio Preserve)
                        page = pdfDoc.addPage([pWidth, pHeight]);
                        
                        const margin = 20; // 20pt margin
                        const maxWidth = pWidth - (margin * 2);
                        const maxHeight = pHeight - (margin * 2);
                        
                        const scale = Math.min(maxWidth / imgImage.width, maxHeight / imgImage.height);
                        const drawWidth = imgImage.width * scale;
                        const drawHeight = imgImage.height * scale;
                        
                        // Center logic
                        const x = (pWidth - drawWidth) / 2;
                        const y = (pHeight - drawHeight) / 2;

                        page.drawImage(imgImage, { x, y, width: drawWidth, height: drawHeight });
                    }
                }
                const pdfBytes = await pdfDoc.save();
                resultBlob = new Blob([pdfBytes], { type: 'application/pdf' });
                fileName = 'converted_images.pdf';
            }

            // 2. Merge PDF
            else if (app.activeTool.id === 'merge') {
                const mergedPdf = await PDFDocument.create();
                for (let i=0; i<app.files.length; i++) {
                    status.innerText = `Merging file ${i+1}...`;
                    const ab = await app.readFileAsArrayBuffer(app.files[i].file);
                    const pdf = await PDFDocument.load(ab);
                    const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    pages.forEach(p => mergedPdf.addPage(p));
                }
                resultBlob = new Blob([await mergedPdf.save()], { type: 'application/pdf' });
                fileName = 'merged.pdf';
            }

            // 3. Compress PDF (Client side logic: Re-draw to canvas, convert to JPG, put back)
            else if (app.activeTool.id === 'compress') {
                status.innerText = "Analyzing pages...";
                const ab = await app.readFileAsArrayBuffer(app.files[0].file);
                const pdf = await pdfjsLib.getDocument(ab).promise;
                const newDoc = await PDFDocument.create();
                
                for(let i=1; i<=pdf.numPages; i++) {
                    status.innerText = `Compressing Page ${i} (This may take time)...`;
                    fill.style.width = `${(i/pdf.numPages)*100}%`;
                    
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({scale: 1.0}); // Scale 1.0 for smaller size
                    const canvas = document.createElement('canvas');
                    canvas.width = viewport.width; canvas.height = viewport.height;
                    await page.render({canvasContext: canvas.getContext('2d'), viewport}).promise;
                    
                    // Convert to low quality JPEG
                    const imgData = canvas.toDataURL('image/jpeg', 0.5); 
                    const img = await newDoc.embedJpg(imgData);
                    const p = newDoc.addPage([viewport.width, viewport.height]);
                    p.drawImage(img, {x:0, y:0, width:viewport.width, height:viewport.height});
                }
                resultBlob = new Blob([await newDoc.save()], { type: 'application/pdf' });
                fileName = 'compressed.pdf';
            }

            // 4. Word to PDF (Mammoth + Simple Text Write)
            else if (app.activeTool.id === 'word-to-pdf') {
                status.innerText = "Extracting text...";
                const ab = await app.readFileAsArrayBuffer(app.files[0].file);
                const result = await mammoth.extractRawText({ arrayBuffer: ab });
                const text = result.value;
                
                const pdfDoc = await PDFDocument.create();
                let page = pdfDoc.addPage();
                const font = await pdfDoc.embedFont(StandardFonts.Helvetica);
                const { width, height } = page.getSize();
                
                const lines = text.split('\n');
                let y = height - 50;
                
                lines.forEach(line => {
                    if (y < 50) { page = pdfDoc.addPage(); y = height - 50; }
                    // Very simple line drawing, real word wrap is complex
                    page.drawText(line.substring(0, 80), { x: 50, y, size: 12, font });
                    y -= 15;
                });
                
                resultBlob = new Blob([await pdfDoc.save()], { type: 'application/pdf' });
                fileName = 'document.pdf';
            }

            // Handle Output
            if (resultBlob) {
                app.handleSuccess(resultBlob, fileName);
            }

        } catch (err) {
            console.error(err);
            alert("Error: " + err.message);
        } finally {
            btn.disabled = false;
            status.innerText = "Done!";
            fill.style.width = '100%';
        }
    },

    handleSuccess: (blob, filename) => {
        const url = URL.createObjectURL(blob);
        const link = document.getElementById('download-link');
        link.href = url;
        link.download = filename;
        
        document.getElementById('result-area').classList.remove('hidden');
        document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
        
        // Render Preview
        app.renderPreview(blob);
    },

    renderPreview: async (blob) => {
        const url = URL.createObjectURL(blob);
        document.getElementById('preview-section').style.display = 'block';
        
        const loadingTask = pdfjsLib.getDocument(url);
        const pdf = await loadingTask.promise;
        const page = await pdf.getPage(1);
        
        const scale = 0.8;
        const viewport = page.getViewport({ scale });
        const canvas = document.getElementById('pdf-preview-canvas');
        const context = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        await page.render({ canvasContext: context, viewport }).promise;
    },

    // Utilities
    readFileAsDataURL: (file) => {
        return new Promise(resolve => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.readAsDataURL(file);
        });
    },
    readFileAsArrayBuffer: (file) => {
        return new Promise(resolve => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.readAsArrayBuffer(file);
        });
    }
};

// Initialize
document.addEventListener('DOMContentLoaded', app.init);

</script>
</body>
</html>